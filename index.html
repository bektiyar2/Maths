<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Math Master 1‚Äì7</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#0077b6">
    <style>
        :root {
            --primary: #4a90e2;
            --success: #2ecc71;
            --danger: #e74c3c;
            --bg: #f0f2f5;
            --text: #2c3e50;
        }

        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: var(--bg); color: var(--text); margin: 0; display: flex; align-items: center; justify-content: center; min-height: 100vh; }
        .card { background: #fff; width: 90%; max-width: 500px; padding: 30px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); text-align: center; transition: all 0.3s ease; }
        h2 { margin-top: 0; color: var(--primary); font-size: 1.8rem; }
        .form-group { text-align: left; margin-bottom: 15px; }
        label { font-weight: bold; display: block; margin-bottom: 5px; font-size: 0.9rem; color: #7f8c8d; }
        select, input { width: 100%; padding: 12px; border: 2px solid #eee; border-radius: 10px; font-size: 16px; box-sizing: border-box; outline: none; }
        button { width: 100%; padding: 15px; background: var(--primary); color: #fff; border: none; border-radius: 10px; font-size: 18px; font-weight: bold; cursor: pointer; margin-top: 10px; }
        .progress-container { width: 100%; height: 8px; background: #eee; border-radius: 4px; margin: 20px 0; overflow: hidden; }
        .progress-bar { height: 100%; background: var(--success); width: 0%; transition: width 0.3s; }
        .task-box { font-size: 2.5rem; font-weight: bold; margin: 30px 0; }
        .hidden { display: none; }
        #result-msg { font-weight: bold; margin: 10px 0; min-height: 24px; }
        .ok { color: var(--success); }
        .bad { color: var(--danger); }
    </style>
</head>
<body>

<div class="card" id="setup-screen">
    <h2 id="ui-title">üìò –ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞</h2>
    <div class="form-group">
        <label>–Ø–∑—ã–∫ / –¢—ñ–ª</label>
        <select id="lang-select"><option value="ru">–†—É—Å—Å–∫–∏–π</option><option value="kk">“ö–∞–∑–∞“õ—à–∞</option></select>
    </div>
    <div class="form-group"><label>–ö–ª–∞—Å—Å</label><select id="grade-select"></select></div>
    <div class="form-group"><label>–¢–µ–º–∞</label><select id="topic-select"></select></div>
    <button onclick="startLesson()" id="ui-start-btn">–ù–∞—á–∞—Ç—å</button>
</div>

<div class="card hidden" id="lesson-screen">
    <div id="ui-counter">–í–æ–ø—Ä–æ—Å 1 –∏–∑ 10</div>
    <div class="progress-container"><div class="progress-bar" id="pb"></div></div>
    <div class="task-box" id="task-display"></div>
    <input id="answer-input" type="number" step="any" placeholder="?">
    <button onclick="checkAnswer()" id="ui-check-btn">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
    <div id="result-msg"></div>
</div>

<div class="card hidden" id="finish-screen">
    <h2 id="ui-finish-title">–û—Ç–ª–∏—á–Ω–æ! üéâ</h2>
    <button onclick="resetApp()" id="ui-back-btn">–ù–∞–∑–∞–¥</button>
</div>

<script>
const UI_TEXT = {
    ru: { title: "üìò –ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞", start: "–ù–∞—á–∞—Ç—å", check: "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å", back: "–ù–∞–∑–∞–¥", correct: "–ü—Ä–∞–≤–∏–ª—å–Ω–æ!", wrong: "–û—à–∏–±–∫–∞! –û—Ç–≤–µ—Ç: " },
    kk: { title: "üìò –ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞", start: "–ë–∞—Å—Ç–∞—É", check: "–¢–µ–∫—Å–µ—Ä—É", back: "–ê—Ä—Ç“õ–∞", correct: "–î“±—Ä—ã—Å!", wrong: "“ö–∞—Ç–µ! –ñ–∞—É–∞–±—ã: " }
};

const TOPICS = {
    ru: { 1:['–°–ª–æ–∂–µ–Ω–∏–µ','–í—ã—á–∏—Ç–∞–Ω–∏–µ'], 2:['–£–º–Ω–æ–∂–µ–Ω–∏–µ','–î–µ–ª–µ–Ω–∏–µ'], 3:['–°–ª–æ–∂–µ–Ω–∏–µ –¥–æ 100','–ó–∞–¥–∞—á–∏'], 4:['–ü–µ—Ä–∏–º–µ—Ç—Ä','–ü–ª–æ—â–∞–¥—å'], 5:['–ü—Ä–æ—Ü–µ–Ω—Ç—ã','–£—Ä–∞–≤–Ω–µ–Ω–∏—è'], 6:['–ü—Ä–æ–ø–æ—Ä—Ü–∏–∏','–ú–∏–Ω—É—Å'], 7:['–£—Ä–∞–≤–Ω–µ–Ω–∏—è','–°—Ç–µ–ø–µ–Ω—å'] },
    kk: { 1:['“ö–æ—Å—É','–ê–∑–∞–π—Ç—É'], 2:['–ö”©–±–µ–π—Ç—É','–ë”©–ª—É'], 3:['100-–≥–µ –¥–µ–π—ñ–Ω “õ–æ—Å—É','–ï—Å–µ–ø—Ç–µ—Ä'], 4:['–ü–µ—Ä–∏–º–µ—Ç—Ä','–ê—É–¥–∞–Ω'], 5:['–ü–∞–π—ã–∑–¥–∞—Ä','–¢–µ“£–¥–µ—É–ª–µ—Ä'], 6:['–ü—Ä–æ–ø–æ—Ä—Ü–∏—è–ª–∞—Ä','–¢–µ—Ä—ñ—Å —Å–∞–Ω–¥–∞—Ä'], 7:['–¢–µ“£–¥–µ—É–ª–µ—Ä','–î”ô—Ä–µ–∂–µ'] }
};

let state = { lang: 'ru', grade: 1, currentStep: 0, maxSteps: 10, currentTask: null };

function init() {
    const gSel = document.getElementById('grade-select');
    for(let i=1; i<=7; i++) { gSel.add(new Option(i, i)); }
    updateLanguage();
    
    // –†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø SERVICE WORKER
    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('sw.js')
            .then(reg => console.log('SW registered'))
            .catch(err => console.log('SW error', err));
    }
}

function updateLanguage() {
    state.lang = document.getElementById('lang-select').value;
    document.getElementById('ui-title').innerText = UI_TEXT[state.lang].title;
    document.getElementById('ui-start-btn').innerText = UI_TEXT[state.lang].start;
    updateTopics();
}

function updateTopics() {
    state.grade = document.getElementById('grade-select').value;
    const tSel = document.getElementById('topic-select');
    tSel.innerHTML = '';
    TOPICS[state.lang][state.grade].forEach((t, i) => tSel.add(new Option(t, i)));
}

function generateTask() {
    const g = parseInt(state.grade);
    const t = parseInt(document.getElementById('topic-select').value);
    const r = (m) => Math.floor(Math.random() * m) + 1;
    
    if(g === 1) {
        let a = r(9), b = r(9);
        return t === 0 ? {q: `${a} + ${b}`, a: a+b} : {q: `${a+b} - ${a}`, a: b};
    }
    if(g === 2) {
        let a = r(8)+1, b = r(8)+1;
        return t === 0 ? {q: `${a} √ó ${b}`, a: a*b} : {q: `${a*b} √∑ ${a}`, a: b};
    }
    // –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –¥–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –∫–ª–∞—Å—Å–æ–≤
    let x = r(20), c = r(20);
    return {q: `x + ${c} = ${x+c}`, a: x};
}

function startLesson() {
    state.currentStep = 0;
    document.getElementById('setup-screen').classList.add('hidden');
    document.getElementById('lesson-screen').classList.remove('hidden');
    nextQuestion();
}

function nextQuestion() {
    if(state.currentStep >= state.maxSteps) {
        document.getElementById('lesson-screen').classList.add('hidden');
        document.getElementById('finish-screen').classList.remove('hidden');
        return;
    }
    state.currentTask = generateTask();
    document.getElementById('task-display').innerText = state.currentTask.q;
    document.getElementById('answer-input').value = '';
    document.getElementById('result-msg').innerText = '';
    document.getElementById('pb').style.width = (state.currentStep / state.maxSteps * 100) + '%';
}

function checkAnswer() {
    const userAns = parseFloat(document.getElementById('answer-input').value);
    if(isNaN(userAns)) return;
    const resDiv = document.getElementById('result-msg');
    
    if(userAns === state.currentTask.a) {
        resDiv.innerHTML = `<span class="ok">${UI_TEXT[state.lang].correct}</span>`;
    } else {
        resDiv.innerHTML = `<span class="bad">${UI_TEXT[state.lang].wrong} ${state.currentTask.a}</span>`;
    }
    state.currentStep++;
    setTimeout(nextQuestion, 1500);
}

document.getElementById('lang-select').onchange = updateLanguage;
document.getElementById('grade-select').onchange = updateTopics;
init();
</script>
</body>
</html>
