<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Math RK: –ü–æ–ª–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞ 1‚Äì7</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#0077b6">
    <style>
        :root { --primary: #0077b6; --success: #2ecc71; --danger: #e74c3c; --bg: #f8f9fa; --text: #2d3436; }
        body { font-family: 'Segoe UI', system-ui, sans-serif; background: var(--bg); color: var(--text); margin: 0; display: flex; align-items: center; justify-content: center; min-height: 100vh; }
        .card { background: #fff; width: 95%; max-width: 480px; padding: 30px; border-radius: 24px; box-shadow: 0 20px 40px rgba(0,0,0,0.08); text-align: center; }
        .hidden { display: none; }
        select, input, button { width: 100%; padding: 15px; margin: 10px 0; border-radius: 14px; border: 2px solid #eee; font-size: 1rem; transition: 0.3s; box-sizing: border-box; }
        select:focus, input:focus { border-color: var(--primary); outline: none; }
        button { background: var(--primary); color: white; border: none; cursor: pointer; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; }
        button:hover { filter: brightness(1.1); transform: translateY(-2px); }
        button:active { transform: translateY(0); }
        .progress-bar { background: #eee; height: 10px; border-radius: 5px; margin: 20px 0; overflow: hidden; }
        .progress-fill { background: var(--success); height: 100%; width: 0%; transition: 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        #task-display { font-size: 2.2rem; margin: 30px 0; font-weight: 800; color: var(--primary); min-height: 80px; display: flex; align-items: center; justify-content: center; }
        .result-msg { font-weight: bold; margin: 15px 0; min-height: 24px; font-size: 1.1rem; }
        .ok { color: var(--success); }
        .bad { color: var(--danger); }
        label { display: block; text-align: left; font-size: 0.85rem; color: #636e72; margin-left: 8px; margin-top: 10px; }
        .badge { display: inline-block; padding: 4px 12px; border-radius: 20px; background: #e1f5fe; color: #0288d1; font-size: 0.8rem; margin-bottom: 10px; }
    </style>
</head>
<body>

<div class="card" id="setup-screen">
    <div class="badge">–ë–∏–ª–∏–Ω–≥–≤–∞–ª–¥—ã / –ë–∏–ª–∏–Ω–≥–≤–∞–ª—å–Ω—ã–π</div>
    <h2 id="ui-title">–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞ –†–ö</h2>
    
    <label>–¢—ñ–ª–¥—ñ —Ç–∞“£–¥–∞“£—ã–∑ / –í—ã–±–µ—Ä–∏—Ç–µ —è–∑—ã–∫:</label>
    <select id="lang-select">
        <option value="ru">–†—É—Å—Å–∫–∏–π —è–∑—ã–∫</option>
        <option value="kk">“ö–∞–∑–∞“õ —Ç—ñ–ª—ñ</option>
    </select>

    <label>–°—ã–Ω—ã–ø / –ö–ª–∞—Å—Å:</label>
    <select id="grade-select"></select>

    <label>–¢–∞“õ—ã—Ä—ã–ø / –¢–µ–º–∞:</label>
    <select id="topic-select"></select>

    <button onclick="startLesson()" id="ui-start-btn">–ë–∞—Å—Ç–∞—É / –ù–∞—á–∞—Ç—å</button>
</div>

<div class="card hidden" id="lesson-screen">
    <div id="ui-counter" style="font-size: 0.9rem; color: #636e72;"></div>
    <div class="progress-bar"><div class="progress-fill" id="pb"></div></div>
    
    <div id="task-display"></div>
    <input type="text" id="answer-input" placeholder="?" inputmode="decimal">
    
    <button onclick="checkAnswer()" id="ui-check-btn">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
    <div id="result-msg" class="result-msg"></div>
    <button onclick="location.reload()" style="background:#dfe6e9; color: #2d3436; font-size: 0.8rem; margin-top: 20px;">‚Ü© –ú–µ–Ω—é</button>
</div>

<div class="card hidden" id="finish-screen">
    <h2 style="font-size: 3rem;">üèÜ</h2>
    <h2 id="ui-finish-title">–ö–µ—Ä–µ–º–µ—Ç!</h2>
    <p id="ui-finish-text">–ë–∞—Ä–ª—ã“õ —Ç–∞–ø—Å—ã—Ä–º–∞–ª–∞—Ä –æ—Ä—ã–Ω–¥–∞–ª–¥—ã.</p>
    <button onclick="location.reload()">“ö–∞–π—Ç–∞–ª–∞—É / –°–Ω–∞—á–∞–ª–∞</button>
</div>



<script>
const UI_TEXT = {
    ru: { start: "–ù–∞—á–∞—Ç—å", check: "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å", correct: "–ü—Ä–∞–≤–∏–ª—å–Ω–æ!", wrong: "–û—à–∏–±–∫–∞! –û—Ç–≤–µ—Ç: ", q: "–í–æ–ø—Ä–æ—Å", finish: "–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º!", subfinish: "–í—ã —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–∏–ª–∏ –∫—É—Ä—Å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏." },
    kk: { start: "–ë–∞—Å—Ç–∞—É", check: "–¢–µ–∫—Å–µ—Ä—É", correct: "–î“±—Ä—ã—Å!", wrong: "“ö–∞—Ç–µ! –ñ–∞—É–∞–±—ã: ", q: "–°“±—Ä–∞“õ", finish: "“ö“±—Ç—Ç—ã“õ—Ç–∞–π–º—ã–∑!", subfinish: "–°—ñ–∑ –∂–∞—Ç—Ç—ã“ì—É –∫—É—Ä—Å—ã–Ω —Å”ô—Ç—Ç—ñ –∞—è“õ—Ç–∞–¥—ã“£—ã–∑." }
};

const TOPICS = {
    ru: { 
        1: ['–°–ª–æ–∂–µ–Ω–∏–µ (0-20)', '–í—ã—á–∏—Ç–∞–Ω–∏–µ (0-20)', '–°—Ä–∞–≤–Ω–µ–Ω–∏–µ (>, <, =)'], 
        2: ['–£–º–Ω–æ–∂–µ–Ω–∏–µ', '–î–µ–ª–µ–Ω–∏–µ', '–ü–µ—Ä–∏–º–µ—Ç—Ä —Ñ–∏–≥—É—Ä—ã'], 
        3: ['–í–Ω–µ—Ç–∞–±–ª–∏—á–Ω–æ–µ —É–º–Ω–æ–∂–µ–Ω–∏–µ', '–î–µ–ª–µ–Ω–∏–µ —Å –æ—Å—Ç–∞—Ç–∫–æ–º', '–£—Ä–∞–≤–Ω–µ–Ω–∏—è'], 
        4: ['–ü–ª–æ—â–∞–¥—å S', '–°–∫–æ—Ä–æ—Å—Ç—å, –≤—Ä–µ–º—è, –ø—É—Ç—å (V, t, S)', '–ú–Ω–æ–≥–æ–∑–Ω–∞—á–Ω—ã–µ —á–∏—Å–ª–∞'], 
        5: ['–î–µ—Å—è—Ç–∏—á–Ω—ã–µ –¥—Ä–æ–±–∏ (—Å–ª–æ–∂–µ–Ω–∏–µ)', '–ü—Ä–æ—Ü–µ–Ω—Ç—ã', '–°—Ä–µ–¥–Ω–µ–µ –∞—Ä–∏—Ñ–º–µ—Ç–∏—á–µ—Å–∫–æ–µ'], 
        6: ['–û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ —á–∏—Å–ª–∞', '–ü—Ä–æ–ø–æ—Ä—Ü–∏–∏', '–ú–æ–¥—É–ª—å —á–∏—Å–ª–∞'], 
        7: ['–õ–∏–Ω–µ–π–Ω—ã–µ —É—Ä–∞–≤–Ω–µ–Ω–∏—è', '–°—Ç–µ–ø–µ–Ω—å —á–∏—Å–ª–∞', '–°–≤–æ–π—Å—Ç–≤–∞ —Å—Ç–µ–ø–µ–Ω–µ–π'] 
    },
    kk: { 
        1: ['“ö–æ—Å—É (0-20)', '–ê–∑–∞–π—Ç—É (0-20)', '–°–∞–ª—ã—Å—Ç—ã—Ä—É (>, <, =)'], 
        2: ['–ö”©–±–µ–π—Ç—É', '–ë”©–ª—É', '–§–∏–≥—É—Ä–∞–Ω—ã“£ –ø–µ—Ä–∏–º–µ—Ç—Ä—ñ'], 
        3: ['–ö–µ—Å—Ç–µ–¥–µ–Ω —Ç—ã—Å –∫”©–±–µ–π—Ç—É', '“ö–∞–ª–¥—ã“õ–ø–µ–Ω –±”©–ª—É', '–¢–µ“£–¥–µ—É–ª–µ—Ä'], 
        4: ['–ê—É–¥–∞–Ω S', '–ñ—ã–ª–¥–∞–º–¥—ã“õ, —É–∞“õ—ã—Ç, –∂–æ–ª (V, t, S)', '–ö”©–ø—Ç–∞“£–±–∞–ª—ã —Å–∞–Ω–¥–∞—Ä'], 
        5: ['–û–Ω–¥—ã“õ –±”©–ª—à–µ–∫—Ç–µ—Ä–¥—ñ “õ–æ—Å—É', '–ü–∞–π—ã–∑–¥–∞—Ä', '–ê—Ä–∏—Ñ–º–µ—Ç–∏–∫–∞–ª—ã“õ –æ—Ä—Ç–∞'], 
        6: ['–¢–µ—Ä—ñ—Å —Å–∞–Ω–¥–∞—Ä', '–ü—Ä–æ–ø–æ—Ä—Ü–∏—è–ª–∞—Ä', '–°–∞–Ω–Ω—ã“£ –º–æ–¥—É–ª—ñ'], 
        7: ['–°—ã–∑—ã“õ—Ç—ã“õ —Ç–µ“£–¥–µ—É–ª–µ—Ä', '–°–∞–Ω–Ω—ã“£ –¥”ô—Ä–µ–∂–µ—Å—ñ', '–î”ô—Ä–µ–∂–µ–ª–µ—Ä–¥—ñ“£ “õ–∞—Å–∏–µ—Ç—Ç–µ—Ä—ñ'] 
    }
};

let state = { lang: 'ru', grade: '1', currentStep: 0, maxSteps: 10, currentTask: null };

function init() {
    const gSel = document.getElementById('grade-select');
    for(let i=1; i<=7; i++) gSel.add(new Option(i + " —Å—ã–Ω—ã–ø / –∫–ª–∞—Å—Å", i));
    
    document.getElementById('lang-select').onchange = updateUI;
    document.getElementById('grade-select').onchange = updateUI;
    updateUI();
}

function updateUI() {
    state.lang = document.getElementById('lang-select').value;
    state.grade = document.getElementById('grade-select').value;
    const tSel = document.getElementById('topic-select');
    tSel.innerHTML = '';
    TOPICS[state.lang][state.grade].forEach((t, i) => tSel.add(new Option(t, i)));
    
    document.getElementById('ui-start-btn').innerText = UI_TEXT[state.lang].start;
    document.getElementById('ui-check-btn').innerText = UI_TEXT[state.lang].check;
}

function generateTask() {
    const g = parseInt(state.grade);
    const t = parseInt(document.getElementById('topic-select').value);
    const r = (m, min=1) => Math.floor(Math.random() * (m - min + 1)) + min;

    switch(g) {
        case 1:
            let a1 = r(15), b1 = r(5);
            if (t === 0) return { q: `${a1} + ${b1}`, a: a1 + b1 };
            if (t === 1) return { q: `${a1+b1} - ${b1}`, a: a1 };
            let c1 = r(20), d1 = r(20); // –°—Ä–∞–≤–Ω–µ–Ω–∏–µ (1-–±–æ–ª—å—à–µ, 2-–º–µ–Ω—å—à–µ, 3-—Ä–∞–≤–Ω–æ)
            return { q: `${c1} ? ${d1} (1:>, 2:<, 3:=)`, a: c1>d1?1:c1<d1?2:3 };

        case 2:
            let a2 = r(9, 2), b2 = r(9, 2);
            if (t <= 1) return t === 0 ? { q: `${a2} √ó ${b2}`, a: a2 * b2 } : { q: `${a2 * b2} √∑ ${a2}`, a: b2 };
            let side = r(10, 2); return { q: state.lang === 'ru' ? `–ü–µ—Ä–∏–º–µ—Ç—Ä –∫–≤–∞–¥—Ä–∞—Ç–∞ (a=${side})` : `–ö–≤–∞–¥—Ä–∞—Ç—Ç—ã“£ –ø–µ—Ä–∏–º–µ—Ç—Ä—ñ (a=${side})`, a: side * 4 };

        case 4:
            if (t === 1) { // V, t, S
                let v = r(20, 5), time = r(5, 2);
                return { q: state.lang === 'ru' ? `S = ?, –µ—Å–ª–∏ V=${v} –∫–º/—á, t=${time} —á` : `S = ?, –µ–≥–µ—Ä V=${v} –∫–º/—Å–∞“ì, t=${time} —Å–∞“ì`, a: v * time };
            }
            let a4 = r(12, 2), b4 = r(8, 2); return { q: `S = ${a4} √ó ${b4}`, a: a4 * b4 };

        case 5:
            if (t === 0) { // –î–µ—Å—è—Ç–∏—á–Ω—ã–µ –¥—Ä–æ–±–∏
                let f1 = (r(50) / 10).toFixed(1), f2 = (r(50) / 10).toFixed(1);
                return { q: `${f1} + ${f2}`, a: parseFloat((parseFloat(f1) + parseFloat(f2)).toFixed(1)) };
            }
            let p5 = [10, 25, 50][r(2,0)], n5 = r(10) * 40;
            return { q: `${p5}% –æ—Ç ${n5}`, a: (n5 * p5) / 100 };

        case 6:
            if (t === 0) { // –û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ —á–∏—Å–ª–∞
                let n6_1 = r(20) * -1, n6_2 = r(30);
                return { q: `${n6_1} + ${n6_2}`, a: n6_1 + n6_2 };
            }
            let x6 = r(10, 2), k6 = r(5, 2); // –ü—Ä–æ–ø–æ—Ä—Ü–∏—è x/k = ans/(k*2)
            return { q: `${x6} / ${k6} = x / ${k6*2}`, a: x6 * 2 };

        case 7:
            if (t === 1) { // –°—Ç–µ–ø–µ–Ω–∏
                let base = r(5, 2), exp = r(3, 2);
                return { q: `${base} ^ ${exp}`, a: Math.pow(base, exp) };
            }
            let ax = r(5, 2), res7 = ax * r(10);
            return { q: `${ax}x = ${res7}, x=?`, a: res7 / ax };

        default:
            let dx = r(20), dc = r(20); return { q: `x + ${dc} = ${dx+dc}, x=?`, a: dx };
    }
}

function startLesson() {
    state.currentStep = 0;
    document.getElementById('setup-screen').classList.add('hidden');
    document.getElementById('lesson-screen').classList.remove('hidden');
    nextQuestion();
}

function nextQuestion() {
    if(state.currentStep >= state.maxSteps) {
        document.getElementById('lesson-screen').classList.add('hidden');
        document.getElementById('finish-screen').classList.remove('hidden');
        document.getElementById('ui-finish-title').innerText = UI_TEXT[state.lang].finish;
        document.getElementById('ui-finish-text').innerText = UI_TEXT[state.lang].subfinish;
        return;
    }
    state.currentTask = generateTask();
    document.getElementById('task-display').innerText = state.currentTask.q;
    document.getElementById('answer-input').value = '';
    document.getElementById('result-msg').innerText = '';
    document.getElementById('pb').style.width = (state.currentStep / state.maxSteps * 100) + '%';
    document.getElementById('ui-counter').innerText = `${UI_TEXT[state.lang].q} ${state.currentStep + 1} / ${state.maxSteps}`;
    document.getElementById('answer-input').focus();
}

function checkAnswer() {
    const inputStr = document.getElementById('answer-input').value.replace(',', '.');
    const userAns = parseFloat(inputStr);
    if(isNaN(userAns)) return;
    
    const resDiv = document.getElementById('result-msg');
    if(Math.abs(userAns - state.currentTask.a) < 0.01) {
        resDiv.className = "result-msg ok";
        resDiv.innerText = UI_TEXT[state.lang].correct;
        state.currentStep++;
        setTimeout(nextQuestion, 1000);
    } else {
        resDiv.className = "result-msg bad";
        resDiv.innerText = UI_TEXT[state.lang].wrong + state.currentTask.a;
    }
}

// –ó–∞–ø—É—Å–∫
init();
</script>
</body>
</html>
