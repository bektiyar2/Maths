<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Math Master PK</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#0077b6">
    <style>
        :root {
            --primary: #4a90e2;
            --success: #2ecc71;
            --danger: #e74c3c;
            --bg: #f0f2f5;
            --text: #2c3e50;
        }

        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background: var(--bg); 
            color: var(--text); 
            margin: 0; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            min-height: 100vh; 
        }

        .card { 
            background: #fff; 
            width: 90%; 
            max-width: 500px; 
            padding: 30px; 
            border-radius: 20px; 
            box-shadow: 0 10px 25px rgba(0,0,0,0.1); 
            text-align: center; 
        }

        .hidden { display: none; }

        select, input, button {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border-radius: 10px;
            border: 1px solid #ddd;
            font-size: 1rem;
        }

        button {
            background: var(--primary);
            color: white;
            border: none;
            cursor: pointer;
            font-weight: bold;
            transition: transform 0.2s;
        }

        button:active { transform: scale(0.98); }

        .progress-container {
            background: #eee;
            height: 10px;
            border-radius: 5px;
            margin: 20px 0;
            overflow: hidden;
        }

        .progress-bar {
            background: var(--success);
            height: 100%;
            width: 0%;
            transition: width 0.3s;
        }

        #task-display { font-size: 2rem; margin: 20px 0; font-weight: bold; color: var(--primary); }
        .ok { color: var(--success); font-weight: bold; }
        .bad { color: var(--danger); font-weight: bold; }
    </style>
</head>
<body>

<div class="card" id="setup-screen">
    <h2 id="ui-title">üìò –ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞</h2>
    
    <label>–Ø–∑—ã–∫ / –¢—ñ–ª:</label>
    <select id="lang-select">
        <option value="ru">–†—É—Å—Å–∫–∏–π</option>
        <option value="kk">“ö–∞–∑–∞“õ—à–∞</option>
    </select>

    <label>–ö–ª–∞—Å—Å / –°—ã–Ω—ã–ø:</label>
    <select id="grade-select"></select>

    <label>–¢–µ–º–∞ / –¢–∞“õ—ã—Ä—ã–ø:</label>
    <select id="topic-select"></select>

    <button id="ui-start-btn" onclick="startLesson()">–ù–∞—á–∞—Ç—å</button>
</div>

<div class="card hidden" id="lesson-screen">
    <div id="ui-counter">–í–æ–ø—Ä–æ—Å 1 –∏–∑ 10</div>
    <div class="progress-container"><div class="progress-bar" id="pb"></div></div>
    
    <div id="task-display"></div>
    <input type="number" id="answer-input" placeholder="–û—Ç–≤–µ—Ç" inputmode="decimal">
    
    <button id="ui-check-btn" onclick="checkAnswer()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
    <div id="result-msg"></div>
    <button id="ui-back-btn" style="background:#95a5a6;" onclick="location.reload()">–ù–∞–∑–∞–¥</button>
</div>

<div class="card hidden" id="finish-screen">
    <h2 id="ui-finish-msg">–û—Ç–ª–∏—á–Ω–æ! üéâ</h2>
    <p>–í—ã –∑–∞–≤–µ—Ä—à–∏–ª–∏ –≤—Å–µ –∑–∞–¥–∞–Ω–∏—è.</p>
    <button onclick="location.reload()">–í –º–µ–Ω—é</button>
</div>



<script>
const UI_TEXT = {
    ru: { title: "üìò –ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞", start: "–ù–∞—á–∞—Ç—å", check: "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å", back: "–ù–∞–∑–∞–¥", correct: "–ü—Ä–∞–≤–∏–ª—å–Ω–æ!", wrong: "–û—à–∏–±–∫–∞! –û—Ç–≤–µ—Ç: ", finish: "–ó–∞–≤–µ—Ä—à–µ–Ω–æ!" },
    kk: { title: "üìò –ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞", start: "–ë–∞—Å—Ç–∞—É", check: "–¢–µ–∫—Å–µ—Ä—É", back: "–ê—Ä—Ç“õ–∞", correct: "–î“±—Ä—ã—Å!", wrong: "“ö–∞—Ç–µ! –ñ–∞—É–∞–±—ã: ", finish: "–ê—è“õ—Ç–∞–ª–¥—ã!" }
};

const TOPICS = {
    ru: { 
        1: ['–°–ª–æ–∂–µ–Ω–∏–µ', '–í—ã—á–∏—Ç–∞–Ω–∏–µ'], 
        2: ['–£–º–Ω–æ–∂–µ–Ω–∏–µ', '–î–µ–ª–µ–Ω–∏–µ'], 
        3: ['–°–ª–æ–∂–µ–Ω–∏–µ –¥–æ 100', '–£—Ä–∞–≤–Ω–µ–Ω–∏—è'], 
        4: ['–ü–ª–æ—â–∞–¥—å –∏ –ü–µ—Ä–∏–º–µ—Ç—Ä', '–ú–Ω–æ–≥–æ–∑–Ω–∞—á–Ω—ã–µ —á–∏—Å–ª–∞'], 
        5: ['–ü—Ä–æ—Ü–µ–Ω—Ç—ã', '–î–µ—Å—è—Ç–∏—á–Ω—ã–µ –¥—Ä–æ–±–∏'], 
        6: ['–ü—Ä–æ–ø–æ—Ä—Ü–∏–∏', '–û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ —á–∏—Å–ª–∞'], 
        7: ['–õ–∏–Ω–µ–π–Ω—ã–µ —É—Ä–∞–≤–Ω–µ–Ω–∏—è', '–°—Ç–µ–ø–µ–Ω–∏'] 
    },
    kk: { 
        1: ['“ö–æ—Å—É', '–ê–∑–∞–π—Ç—É'], 
        2: ['–ö”©–±–µ–π—Ç—É', '–ë”©–ª—É'], 
        3: ['100-–≥–µ –¥–µ–π—ñ–Ω “õ–æ—Å—É', '–¢–µ“£–¥–µ—É–ª–µ—Ä'], 
        4: ['–ê—É–¥–∞–Ω –∂”ô–Ω–µ –ü–µ—Ä–∏–º–µ—Ç—Ä', '–ö”©–ø—Ç–∞“£–±–∞–ª—ã —Å–∞–Ω–¥–∞—Ä'], 
        5: ['–ü–∞–π—ã–∑–¥–∞—Ä', '–û–Ω–¥—ã“õ –±”©–ª—à–µ–∫—Ç–µ—Ä'], 
        6: ['–ü—Ä–æ–ø–æ—Ä—Ü–∏—è–ª–∞—Ä', '–¢–µ—Ä—ñ—Å —Å–∞–Ω–¥–∞—Ä'], 
        7: ['–°—ã–∑—ã“õ—Ç—ã“õ —Ç–µ“£–¥–µ—É–ª–µ—Ä', '–î”ô—Ä–µ–∂–µ–ª–µ—Ä'] 
    }
};

let state = { lang: 'ru', grade: '1', currentStep: 0, maxSteps: 10, currentTask: null };

function init() {
    const gSel = document.getElementById('grade-select');
    for(let i=1; i<=7; i++) { 
        gSel.add(new Option(i + " –∫–ª–∞—Å—Å", i)); 
    }
    
    document.getElementById('lang-select').onchange = updateLanguage;
    document.getElementById('grade-select').onchange = updateTopics;
    
    updateLanguage(); // –ü–µ—Ä–≤–∏—á–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('sw.js').catch(err => console.log('SW error', err));
    }
}

function updateLanguage() {
    state.lang = document.getElementById('lang-select').value;
    const ui = UI_TEXT[state.lang];
    document.getElementById('ui-title').innerText = ui.title;
    document.getElementById('ui-start-btn').innerText = ui.start;
    document.getElementById('ui-check-btn').innerText = ui.check;
    document.getElementById('ui-back-btn').innerText = ui.back;
    updateTopics();
}

function updateTopics() {
    state.grade = document.getElementById('grade-select').value;
    const tSel = document.getElementById('topic-select');
    tSel.innerHTML = '';
    
    const currentGradeTopics = TOPICS[state.lang][state.grade];
    if (currentGradeTopics) {
        currentGradeTopics.forEach((t, i) => {
            tSel.add(new Option(t, i));
        });
    }
}

function generateTask() {
    const g = parseInt(state.grade);
    const t = parseInt(document.getElementById('topic-select').value);
    const r = (m) => Math.floor(Math.random() * m) + 1;
    
    if(g === 1) {
        let a = r(9), b = r(9);
        return t === 0 ? {q: `${a} + ${b}`, a: a+b} : {q: `${a+b} - ${a}`, a: b};
    }
    if(g === 2) {
        let a = r(8)+1, b = r(8)+1;
        return t === 0 ? {q: `${a} √ó ${b}`, a: a*b} : {q: `${a*b} √∑ ${a}`, a: b};
    }
    if(g === 5 && t === 0) { // –ü—Ä–æ—Ü–µ–Ω—Ç—ã
        let nums = [50, 100, 200, 500];
        let n = nums[r(4)-1];
        let p = [10, 20, 25, 50][r(4)-1];
        return {q: `${p}% –æ—Ç ${n}`, a: (n * p) / 100};
    }
    
    // –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä —É—Ä–∞–≤–Ω–µ–Ω–∏–π –¥–ª—è 3-7 –∫–ª–∞—Å—Å–æ–≤
    let x = r(20), c = r(20);
    return {q: `x + ${c} = ${x+c}, x=?`, a: x};
}

function startLesson() {
    state.currentStep = 0;
    document.getElementById('setup-screen').classList.add('hidden');
    document.getElementById('lesson-screen').classList.remove('hidden');
    nextQuestion();
}

function nextQuestion() {
    if(state.currentStep >= state.maxSteps) {
        document.getElementById('lesson-screen').classList.add('hidden');
        document.getElementById('finish-screen').classList.remove('hidden');
        return;
    }
    state.currentTask = generateTask();
    document.getElementById('task-display').innerText = state.currentTask.q;
    document.getElementById('answer-input').value = '';
    document.getElementById('result-msg').innerText = '';
    document.getElementById('pb').style.width = (state.currentStep / state.maxSteps * 100) + '%';
    document.getElementById('ui-counter').innerText = 
        (state.lang === 'ru' ? '–í–æ–ø—Ä–æ—Å ' : '–°“±—Ä–∞“õ ') + (state.currentStep + 1) + ' / ' + state.maxSteps;
}

function checkAnswer() {
    const input = document.getElementById('answer-input');
    const userAns = parseFloat(input.value);
    if(isNaN(userAns)) return;
    
    const resDiv = document.getElementById('result-msg');
    if(userAns === state.currentTask.a) {
        resDiv.innerHTML = `<span class="ok">${UI_TEXT[state.lang].correct}</span>`;
    } else {
        resDiv.innerHTML = `<span class="bad">${UI_TEXT[state.lang].wrong} ${state.currentTask.a}</span>`;
    }
    
    state.currentStep++;
    setTimeout(nextQuestion, 1500);
}

// –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
init();
</script>

</body>
</html>
