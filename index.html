<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Math Master 1‚Äì7</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        :root {
            --primary: #4a90e2;
            --success: #2ecc71;
            --danger: #e74c3c;
            --bg: #f0f2f5;
            --text: #2c3e50;
        }

        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: var(--bg); color: var(--text); margin: 0; display: flex; align-items: center; justify-content: center; min-height: 100vh; }
        
        .card { background: #fff; width: 90%; max-width: 500px; padding: 30px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); text-align: center; transition: all 0.3s ease; }
        
        h2 { margin-top: 0; color: var(--primary); font-size: 1.8rem; }
        
        .form-group { text-align: left; margin-bottom: 15px; }
        label { font-weight: bold; display: block; margin-bottom: 5px; font-size: 0.9rem; color: #7f8c8d; }
        
        select, input { width: 100%; padding: 12px; border: 2px solid #eee; border-radius: 10px; font-size: 16px; box-sizing: border-box; outline: none; transition: border-color 0.3s; }
        select:focus, input:focus { border-color: var(--primary); }
        
        button { width: 100%; padding: 15px; background: var(--primary); color: #fff; border: none; border-radius: 10px; font-size: 18px; font-weight: bold; cursor: pointer; margin-top: 10px; transition: transform 0.1s, opacity 0.3s; }
        button:active { transform: scale(0.98); }
        button:disabled { opacity: 0.5; cursor: not-allowed; }

        .progress-container { width: 100%; height: 8px; background: #eee; border-radius: 4px; margin: 20px 0; overflow: hidden; }
        .progress-bar { height: 100%; background: var(--success); width: 0%; transition: width 0.3s; }

        .task-box { font-size: 2.5rem; font-weight: bold; margin: 30px 0; color: var(--text); }
        
        #result-msg { font-weight: bold; margin: 10px 0; min-height: 24px; }
        .ok { color: var(--success); }
        .bad { color: var(--danger); }

        .hidden { display: none; }
        
        .stats { font-size: 0.9rem; color: #7f8c8d; margin-bottom: 10px; }
    </style>
</head>
<body>

<div class="card" id="setup-screen">
    <h2 id="ui-title">üìò –ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞</h2>
    
    <div class="form-group">
        <label id="ui-lang-label">–Ø–∑—ã–∫ / –¢—ñ–ª</label>
        <select id="lang-select">
            <option value="ru">–†—É—Å—Å–∫–∏–π</option>
            <option value="kk">“ö–∞–∑–∞“õ—à–∞</option>
        </select>
    </div>

    <div class="form-group">
        <label id="ui-grade-label">–ö–ª–∞—Å—Å</label>
        <select id="grade-select"></select>
    </div>

    <div class="form-group">
        <label id="ui-topic-label">–¢–µ–º–∞</label>
        <select id="topic-select"></select>
    </div>

    <button onclick="startLesson()" id="ui-start-btn">–ù–∞—á–∞—Ç—å</button>
</div>

<div class="card hidden" id="lesson-screen">
    <div class="stats" id="ui-counter">–í–æ–ø—Ä–æ—Å 1 –∏–∑ 10</div>
    <div class="progress-container">
        <div class="progress-bar" id="pb"></div>
    </div>
    
    <div class="task-box" id="task-display"></div>
    
    <input id="answer-input" type="number" step="any" placeholder="?">
    <button onclick="checkAnswer()" id="ui-check-btn">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
    <div id="result-msg"></div>
</div>

<div class="card hidden" id="finish-screen">
    <h2 id="ui-finish-title">–û—Ç–ª–∏—á–Ω–æ! üéâ</h2>
    <p id="ui-finish-msg">–£—Ä–æ–∫ –∑–∞–≤–µ—Ä—à–µ–Ω. –¢—ã –æ—Ç–ª–∏—á–Ω–æ —Å–ø—Ä–∞–≤–∏–ª—Å—è!</p>
    <button onclick="resetApp()" id="ui-back-btn">–ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é</button>
</div>

<script>
/* ================== –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø –ò –î–ê–ù–ù–´–ï ================== */
const UI_TEXT = {
    ru: {
        title: "üìò –ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞", lang: "–Ø–∑—ã–∫", grade: "–ö–ª–∞—Å—Å", topic: "–¢–µ–º–∞", 
        start: "–ù–∞—á–∞—Ç—å", check: "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å", back: "–ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é",
        qCount: "–í–æ–ø—Ä–æ—Å", finish: "–û—Ç–ª–∏—á–Ω–æ! üéâ", finishMsg: "–£—Ä–æ–∫ –∑–∞–≤–µ—Ä—à–µ–Ω!",
        correct: "–ü—Ä–∞–≤–∏–ª—å–Ω–æ!", wrong: "–û—à–∏–±–∫–∞. –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç: "
    },
    kk: {
        title: "üìò –ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞", lang: "–¢—ñ–ª", grade: "–°—ã–Ω—ã–ø", topic: "–¢–∞“õ—ã—Ä—ã–ø", 
        start: "–ë–∞—Å—Ç–∞—É", check: "–¢–µ–∫—Å–µ—Ä—É", back: "–ú”ô–∑—ñ—Ä–≥–µ –æ—Ä–∞–ª—É",
        qCount: "–°“±—Ä–∞“õ", finish: "–ñ–∞—Ä–∞–π—Å—ã“£! üéâ", finishMsg: "–°–∞–±–∞“õ –∞—è“õ—Ç–∞–ª–¥—ã!",
        correct: "–î“±—Ä—ã—Å!", wrong: "“ö–∞—Ç–µ. –î“±—Ä—ã—Å –∂–∞—É–∞–±—ã: "
    }
};

const TOPICS = {
    ru: {
        1:['–°–ª–æ–∂–µ–Ω–∏–µ –¥–æ 10','–í—ã—á–∏—Ç–∞–Ω–∏–µ –¥–æ 10'],
        2:['–¢–∞–±–ª–∏—Ü–∞ —É–º–Ω–æ–∂–µ–Ω–∏—è','–î–µ–ª–µ–Ω–∏–µ'],
        3:['–°–ª–æ–∂–µ–Ω–∏–µ –∏ –≤—ã—á–∏—Ç–∞–Ω–∏–µ (100)','–¢–µ–∫—Å—Ç–æ–≤—ã–µ –∑–∞–¥–∞—á–∏'],
        4:['–ü–µ—Ä–∏–º–µ—Ç—Ä','–ü–ª–æ—â–∞–¥—å –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫–∞'],
        5:['–ü—Ä–æ—Ü–µ–Ω—Ç—ã','–£—Ä–∞–≤–Ω–µ–Ω–∏—è'],
        6:['–ü—Ä–æ–ø–æ—Ä—Ü–∏–∏','–û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ —á–∏—Å–ª–∞'],
        7:['–õ–∏–Ω–µ–π–Ω—ã–µ —É—Ä–∞–≤–Ω–µ–Ω–∏—è','–°—Ç–µ–ø–µ–Ω—å —á–∏—Å–ª–∞']
    },
    kk: {
        1:['10-“ì–∞ –¥–µ–π—ñ–Ω “õ–æ—Å—É','10-“ì–∞ –¥–µ–π—ñ–Ω –∞–∑–∞–π—Ç—É'],
        2:['–ö”©–±–µ–π—Ç—É –∫–µ—Å—Ç–µ—Å—ñ','–ë”©–ª—É'],
        3:['“ö–æ—Å—É –∂”ô–Ω–µ –∞–∑–∞–π—Ç—É (100)','–ú”ô—Ç—ñ–Ω–¥—ñ –µ—Å–µ–ø—Ç–µ—Ä'],
        4:['–ü–µ—Ä–∏–º–µ—Ç—Ä','–¢—ñ–∫—Ç”©—Ä—Ç–±“±—Ä—ã—à –∞—É–¥–∞–Ω—ã'],
        5:['–ü–∞–π—ã–∑–¥–∞—Ä','–¢–µ“£–¥–µ—É–ª–µ—Ä'],
        6:['–ü—Ä–æ–ø–æ—Ä—Ü–∏—è–ª–∞—Ä','–¢–µ—Ä—ñ—Å —Å–∞–Ω–¥–∞—Ä'],
        7:['–°—ã–∑—ã“õ—Ç—ã“õ —Ç–µ“£–¥–µ—É–ª–µ—Ä','–°–∞–Ω–Ω—ã“£ –¥”ô—Ä–µ–∂–µ—Å—ñ']
    }
};

/* ================== –õ–û–ì–ò–ö–ê –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø ================== */
let state = {
    lang: 'ru',
    grade: 1,
    topicIdx: 0,
    currentStep: 0,
    maxSteps: 10,
    currentTask: null
};

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
function init() {
    const gradeSel = document.getElementById('grade-select');
    for(let i=1; i<=7; i++) {
        let opt = document.createElement('option');
        opt.value = i; opt.innerText = i;
        gradeSel.appendChild(opt);
    }
    updateLanguage();
}

function updateLanguage() {
    state.lang = document.getElementById('lang-select').value;
    const ui = UI_TEXT[state.lang];
    
    document.getElementById('ui-title').innerText = ui.title;
    document.getElementById('ui-grade-label').innerText = ui.grade;
    document.getElementById('ui-topic-label').innerText = ui.topic;
    document.getElementById('ui-start-btn').innerText = ui.start;
    
    updateTopics();
}

function updateTopics() {
    state.grade = document.getElementById('grade-select').value;
    const topicSel = document.getElementById('topic-select');
    topicSel.innerHTML = '';
    
    TOPICS[state.lang][state.grade].forEach((t, i) => {
        let opt = document.createElement('option');
        opt.value = i; opt.innerText = t;
        topicSel.appendChild(opt);
    });
}

/* ================== –ì–ï–ù–ï–†–ê–¢–û–† –ó–ê–î–ê–ß ================== */
function generateTask() {
    const g = parseInt(state.grade);
    const t = parseInt(document.getElementById('topic-select').value);
    const r = (m) => Math.floor(Math.random() * m);
    
    // –ü—Ä–æ—Å—Ç–∞—è –ª–æ–≥–∏–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ç–∏–ø–∞ –∑–∞–¥–∞—á–∏ –ø–æ –∫–ª–∞—Å—Å—É –∏ –∏–Ω–¥–µ–∫—Å—É —Ç–µ–º—ã
    if(g === 1) {
        let a = r(9)+1, b = r(9)+1;
        return t === 0 ? {q: `${a} + ${b}`, a: a+b} : {q: `${a+b} - ${a}`, a: b};
    }
    if(g === 2) {
        let a = r(7)+2, b = r(7)+2;
        return t === 0 ? {q: `${a} √ó ${b}`, a: a*b} : {q: `${a*b} √∑ ${a}`, a: b};
    }
    if(g === 4) {
        let a = r(15)+2, b = r(10)+2;
        return t === 0 ? {q: `P (a=${a}, b=${b})`, a: 2*(a+b)} : {q: `S (a=${a}, b=${b})`, a: a*b};
    }
    if(g === 5 && t === 0) {
        let bases = [100, 200, 50, 400], p = [10, 20, 25, 50];
        let b = bases[r(4)], per = p[r(4)];
        return {q: `${per}% –æ—Ç ${b}`, a: b * per / 100};
    }
    // –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–µ —É—Ä–∞–≤–Ω–µ–Ω–∏–µ –¥–ª—è 5-7 –∫–ª–∞—Å—Å–æ–≤
    let x = r(20)+1, c = r(20)+1;
    return {q: `x + ${c} = ${x+c}`, a: x};
}

/* ================== –ò–ì–†–û–í–û–ô –ü–†–û–¶–ï–°–° ================== */
function startLesson() {
    state.currentStep = 0;
    state.topicIdx = document.getElementById('topic-select').value;
    document.getElementById('setup-screen').classList.add('hidden');
    document.getElementById('lesson-screen').classList.remove('hidden');
    nextQuestion();
}

function nextQuestion() {
    if(state.currentStep >= state.maxSteps) {
        showFinish();
        return;
    }
    
    state.currentTask = generateTask();
    document.getElementById('task-display').innerText = state.currentTask.q;
    document.getElementById('answer-input').value = '';
    document.getElementById('result-msg').innerText = '';
    document.getElementById('ui-counter').innerText = `${UI_TEXT[state.lang].qCount} ${state.currentStep + 1} / ${state.maxSteps}`;
    document.getElementById('pb').style.width = (state.currentStep / state.maxSteps * 100) + '%';
    document.getElementById('answer-input').focus();
}

function checkAnswer() {
    const userAns = parseFloat(document.getElementById('answer-input').value);
    const resDiv = document.getElementById('result-msg');
    const btn = document.getElementById('ui-check-btn');
    
    if(isNaN(userAns)) return;

    btn.disabled = true;
    if(userAns === state.currentTask.a) {
        resDiv.innerHTML = `<span class="ok">${UI_TEXT[state.lang].correct}</span>`;
    } else {
        resDiv.innerHTML = `<span class="bad">${UI_TEXT[state.lang].wrong} ${state.currentTask.a}</span>`;
    }

    state.currentStep++;
    setTimeout(() => {
        btn.disabled = false;
        nextQuestion();
    }, 1500);
}

function showFinish() {
    document.getElementById('lesson-screen').classList.add('hidden');
    document.getElementById('finish-screen').classList.remove('hidden');
    const ui = UI_TEXT[state.lang];
    document.getElementById('ui-finish-title').innerText = ui.finish;
    document.getElementById('ui-finish-msg').innerText = ui.finishMsg;
    document.getElementById('ui-back-btn').innerText = ui.back;
}

function resetApp() {
    document.getElementById('finish-screen').classList.add('hidden');
    document.getElementById('setup-screen').classList.remove('hidden');
}

// –ü—Ä–∏–≤—è–∑–∫–∞ —Å–æ–±—ã—Ç–∏–π
document.getElementById('lang-select').onchange = updateLanguage;
document.getElementById('grade-select').onchange = updateTopics;
document.getElementById('answer-input').onkeypress = (e) => { if(e.key === 'Enter') checkAnswer(); };

init();
</script>
</body>
</html>
