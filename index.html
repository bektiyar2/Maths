<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞ 1‚Äì7 –∫–ª–∞—Å—Å—ã</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f4f6f8;
            margin: 0;
            padding: 0;
        }

        header {
            background: #2c3e50;
            color: white;
            padding: 15px;
            text-align: center;
        }

        main {
            max-width: 700px;
            margin: 20px auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        select, button, input {
            width: 100%;
            padding: 10px;
            margin: 8px 0;
            font-size: 16px;
        }

        button {
            background: #3498db;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }

        button:hover {
            background: #2980b9;
        }

        .task {
            font-size: 22px;
            margin: 20px 0;
            text-align: center;
        }

        .result {
            margin-top: 15px;
            font-weight: bold;
        }

        .ok { color: green; }
        .bad { color: red; }

        footer {
            text-align: center;
            font-size: 14px;
            color: #888;
            margin-top: 30px;
        }
    </style>
</head>
<body>

<header>
    <h1>üìò –ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞ (1‚Äì7 –∫–ª–∞—Å—Å—ã)</h1>
</header>

<main>
    <label>–Ø–∑—ã–∫:</label>
    <select id="lang">
        <option value="ru">–†—É—Å—Å–∫–∏–π</option>
        <option value="kk">“ö–∞–∑–∞“õ—à–∞</option>
    </select>

    <label>–ö–ª–∞—Å—Å:</label>
    <select id="grade"></select>

    <label>–¢–µ–º–∞:</label>
    <select id="topic"></select>

    <button onclick="startLesson()">–ù–∞—á–∞—Ç—å</button>

    <div id="lesson" style="display:none;">
        <div class="task" id="taskText"></div>
        <input type="number" id="answer" placeholder="–í–∞—à –æ—Ç–≤–µ—Ç">
        <button onclick="check()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
        <div class="result" id="result"></div>
    </div>
</main>

<footer>
    –£—á–µ–±–Ω—ã–π —Ç—Ä–µ–Ω–∞–∂—ë—Ä ‚Ä¢ 1‚Äì7 –∫–ª–∞—Å—Å—ã
</footer>

<script>
/* =========================================================
   –î–ê–ù–ù–´–ï (ru + kk)
   ========================================================= */

let currentLanguage = 'ru';
let currentGrade = null;
let currentTopic = null;
let currentTask = null;

const topicsRu = {
    1: ['–°–ª–æ–∂–µ–Ω–∏–µ –¥–æ 10', '–í—ã—á–∏—Ç–∞–Ω–∏–µ –¥–æ 10'],
    2: ['–¢–∞–±–ª–∏—Ü–∞ —É–º–Ω–æ–∂–µ–Ω–∏—è', '–î–µ–ª–µ–Ω–∏–µ'],
    3: ['–°–ª–æ–∂–µ–Ω–∏–µ –∏ –≤—ã—á–∏—Ç–∞–Ω–∏–µ', '–¢–µ–∫—Å—Ç–æ–≤—ã–µ –∑–∞–¥–∞—á–∏'],
    4: ['–î—Ä–æ–±–∏', '–ü–µ—Ä–∏–º–µ—Ç—Ä –∏ –ø–ª–æ—â–∞–¥—å'],
    5: ['–ü—Ä–æ—Ü–µ–Ω—Ç—ã', '–£—Ä–∞–≤–Ω–µ–Ω–∏—è'],
    6: ['–î–µ—Å—è—Ç–∏—á–Ω—ã–µ –¥—Ä–æ–±–∏', '–ü—Ä–æ–ø–æ—Ä—Ü–∏–∏'],
    7: ['–õ–∏–Ω–µ–π–Ω—ã–µ —É—Ä–∞–≤–Ω–µ–Ω–∏—è', '–ü—Ä–æ—Ü–µ–Ω—Ç—ã']
};

const topics = {
    1: ['10-“ì–∞ –¥–µ–π—ñ–Ω “õ–æ—Å—É', '10-“ì–∞ –¥–µ–π—ñ–Ω –∞–∑–∞–π—Ç—É'],
    2: ['–ö”©–±–µ–π—Ç—É –∫–µ—Å—Ç–µ—Å—ñ', '–ë”©–ª—É'],
    3: ['“ö–æ—Å—É –∂”ô–Ω–µ –∞–∑–∞–π—Ç—É', '–ú”ô—Ç—ñ–Ω–¥—ñ –µ—Å–µ–ø—Ç–µ—Ä'],
    4: ['–ë”©–ª—à–µ–∫—Ç–µ—Ä', '–ü–µ—Ä–∏–º–µ—Ç—Ä –∂”ô–Ω–µ –∞—É–¥–∞–Ω'],
    5: ['–ü–∞–π—ã–∑–¥–∞—Ä', '–¢–µ“£–¥–µ—É–ª–µ—Ä'],
    6: ['–û–Ω–¥—ã“õ –±”©–ª—à–µ–∫—Ç–µ—Ä', '–ü—Ä–æ–ø–æ—Ä—Ü–∏—è–ª–∞—Ä'],
    7: ['–°—ã–∑—ã“õ—Ç—ã“õ —Ç–µ“£–¥–µ—É–ª–µ—Ä', '–ü–∞–π—ã–∑–¥–∞—Ä']
};

function getTopicId(name) {
    if (name.includes('–°–ª–æ–∂') || name.includes('“ö–æ—Å—É')) return 'addition_10';
    if (name.includes('–í—ã—á') || name.includes('–ê–∑–∞–π—Ç—É')) return 'subtraction_10';
    if (name.includes('—É–º–Ω–æ–∂') || name.includes('–ö”©–±–µ–π')) return 'multiplication_table';
    if (name.includes('–î–µ–ª') || name.includes('–ë”©–ª—É')) return 'division';
    if (name.includes('–ü—Ä–æ—Ü') || name.includes('–ü–∞–π—ã–∑')) return 'percentages';
    if (name.includes('–£—Ä–∞–≤') || name.includes('–¢–µ“£–¥–µ—É')) return 'equations';
    if (name.includes('–î—Ä–æ–±') || name.includes('–ë”©–ª—à')) return 'fractions';
    if (name.includes('–ü–µ—Ä–∏–º') || name.includes('–∞—É–¥–∞–Ω')) return 'area';
    return 'default';
}

/* =========================================================
   TASK ENGINE (–§–ò–ù–ê–õ)
   ========================================================= */

const TASK_MODE = 'stable';
const TASKS_PER_TOPIC = 10;
const taskBank = {};

function mulberry32(seed) {
    return function () {
        let t = seed += 0x6D2B79F5;
        t = Math.imul(t ^ t >>> 15, t | 1);
        t ^= t + Math.imul(t ^ t >>> 7, t | 61);
        return ((t ^ t >>> 14) >>> 0) / 4294967296;
    }
}

function seedKey(g, t) {
    return g * 10007 ^ t * 7919;
}

const Progress = {
    load() {
        return JSON.parse(localStorage.getItem('math_progress') || '{}');
    },
    save(d) {
        localStorage.setItem('math_progress', JSON.stringify(d));
    },
    get(g, t) {
        const d = this.load();
        return d[`${g}_${t}`] || { i: 0, ok: 0, bad: 0 };
    },
    set(g, t, v) {
        const d = this.load();
        d[`${g}_${t}`] = v;
        this.save(d);
    }
};

function generateTask(id, rng) {
    if (id === 'addition_10') {
        let a = Math.floor(rng()*9)+1, b = Math.floor(rng()*9)+1;
        return { q:`${a} + ${b}`, a:a+b };
    }
    if (id === 'subtraction_10') {
        let a = Math.floor(rng()*9)+2, b = Math.floor(rng()*a);
        return { q:`${a} ‚àí ${b}`, a:a-b };
    }
    if (id === 'multiplication_table') {
        let a = Math.floor(rng()*8)+2, b = Math.floor(rng()*8)+2;
        return { q:`${a} √ó ${b}`, a:a*b };
    }
    if (id === 'division') {
        let b = Math.floor(rng()*8)+2, r = Math.floor(rng()*8)+2;
        return { q:`${b*r} √∑ ${b}`, a:r };
    }
    if (id === 'percentages') {
        let base=[100,200,500][Math.floor(rng()*3)];
        let p=[10,20,50][Math.floor(rng()*3)];
        return { q:`${p}% –æ—Ç ${base}`, a:base*p/100 };
    }
    if (id === 'equations') {
        let x=Math.floor(rng()*20)+1, c=Math.floor(rng()*20)+5;
        return { q:`x + ${c} = ${x+c}`, a:x };
    }
    return { q:'1 + 1', a:2 };
}

function buildTaskBank() {
    for (let g=1; g<=7; g++) {
        taskBank[g]={};
        const list = currentLanguage==='ru'?topicsRu[g]:topics[g];
        list.forEach((n,i)=>{
            const rng = mulberry32(seedKey(g,i));
            taskBank[g][i]=[];
            for(let k=0;k<TASKS_PER_TOPIC;k++){
                taskBank[g][i].push(generateTask(getTopicId(n),rng));
            }
        });
    }
}

/* =========================================================
   UI –õ–û–ì–ò–ö–ê
   ========================================================= */

function init() {
    document.getElementById('lang').onchange=e=>{
        currentLanguage=e.target.value;
        fillGrades();
    };
    fillGrades();
}

function fillGrades() {
    const gSel=document.getElementById('grade');
    gSel.innerHTML='';
    for(let i=1;i<=7;i++){
        gSel.innerHTML+=`<option value="${i}">${i} –∫–ª–∞—Å—Å</option>`;
    }
    gSel.onchange=fillTopics;
    fillTopics();
}

function fillTopics() {
    currentGrade=document.getElementById('grade').value;
    const tSel=document.getElementById('topic');
    const list=currentLanguage==='ru'?topicsRu[currentGrade]:topics[currentGrade];
    tSel.innerHTML='';
    list.forEach(t=>tSel.innerHTML+=`<option>${t}</option>`);
}

function startLesson() {
    currentGrade=document.getElementById('grade').value;
    currentTopic=document.getElementById('topic').value;
    buildTaskBank();
    document.getElementById('lesson').style.display='block';
    nextTask();
}

function nextTask() {
    const list=currentLanguage==='ru'?topicsRu[currentGrade]:topics[currentGrade];
    const idx=list.indexOf(currentTopic);
    const p=Progress.get(currentGrade,idx);
    currentTask=taskBank[currentGrade][idx][p.i];
    document.getElementById('taskText').innerText=currentTask.q;
    document.getElementById('answer').value='';
    document.getElementById('result').innerText='';
}

function check() {
    const ans=Number(document.getElementById('answer').value);
    const list=currentLanguage==='ru'?topicsRu[currentGrade]:topics[currentGrade];
    const idx=list.indexOf(currentTopic);
    const p=Progress.get(currentGrade,idx);
    if(ans===currentTask.a){
        p.ok++;
        document.getElementById('result').innerHTML='<span class="ok">–í–µ—Ä–Ω–æ</span>';
    } else {
        p.bad++;
        document.getElementById('result').innerHTML='<span class="bad">–ù–µ–≤–µ—Ä–Ω–æ</span>';
    }
    p.i=(p.i+1)%TASKS_PER_TOPIC;
    Progress.set(currentGrade,idx,p);
    setTimeout(nextTask,800);
}

init();
</script>

</body>
</html>