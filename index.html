<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞ –¥–ª—è —à–∫–æ–ª—å–Ω–∏–∫–æ–≤ 1-7 –∫–ª–∞—Å—Å–æ–≤ –ø–æ –ø—Ä–æ–≥—Ä–∞–º–º–µ –ú–∏–Ω–∏—Å—Ç–µ—Ä—Å—Ç–≤–∞ –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –†–ö">
    <meta name="theme-color" content="#0077b6">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞ –†–ö">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon-192.png">
    <title>–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞ - –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #00a8cc 0%, #0077b6 50%, #023e8a 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; background: white; border-radius: 20px; padding: 30px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); }
        .header { text-align: center; margin-bottom: 30px; }
        h1 { color: #0077b6; font-size: 2.2em; margin-bottom: 10px; }
        .subtitle { color: #666; font-size: 1.1em; }
        .name-input-section { background: linear-gradient(135deg, #e0f7fa 0%, #b2ebf2 100%); padding: 20px; border-radius: 12px; margin-bottom: 20px; text-align: center; }
        .name-input { padding: 12px 20px; font-size: 1.1em; border: 2px solid #0077b6; border-radius: 8px; width: 300px; max-width: 100%; }
        .tabs { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; justify-content: center; }
        .tab { padding: 12px 24px; border: 2px solid #0077b6; background: white; color: #0077b6; border-radius: 8px; cursor: pointer; font-weight: bold; transition: all 0.3s; }
        .tab.active { background: #0077b6; color: white; }
        .tab:hover { transform: translateY(-2px); }
        .stats-section { display: none; }
        .stats-section.active { display: block; }
        .leaderboard { background: #f8f9fa; border-radius: 12px; padding: 20px; margin-bottom: 20px; }
        .leaderboard table { width: 100%; border-collapse: collapse; }
        .leaderboard th { background: #0077b6; color: white; padding: 12px; text-align: left; }
        .leaderboard td { padding: 10px; border-bottom: 1px solid #ddd; }
        .leaderboard tr:hover { background: #f0f9ff; }
        .medal { font-size: 1.5em; }
        .grade-selection { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 15px; margin-bottom: 30px; }
        .grade-btn { padding: 20px; border: 3px solid #0077b6; background: white; color: #0077b6; border-radius: 12px; cursor: pointer; font-size: 1.2em; font-weight: bold; transition: all 0.3s; }
        .grade-btn:hover { background: #0077b6; color: white; transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0,119,182,0.3); }
        .topic-selection { display: none; }
        .topic-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 15px; margin-bottom: 20px; }
        .topic-btn { padding: 15px; border: 2px solid #023e8a; background: white; color: #023e8a; border-radius: 10px; cursor: pointer; font-size: 1em; transition: all 0.3s; text-align: left; }
        .topic-btn:hover { background: #023e8a; color: white; transform: translateX(5px); }
        .quiz-area { display: none; }
        .questions-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 25px; }
        .question-card { background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); padding: 25px; border-radius: 15px; border-left: 5px solid #0077b6; }
        .question-number { color: #0077b6; font-size: 0.9em; margin-bottom: 10px; font-weight: bold; }
        .question-text { font-size: 1.2em; color: #333; margin-bottom: 15px; line-height: 1.6; }
        .answer-input { width: 100%; padding: 12px; font-size: 1.1em; border: 3px solid #ddd; border-radius: 8px; margin-bottom: 10px; text-align: center; transition: all 0.3s; }
        .answer-input:focus { outline: none; border-color: #0077b6; box-shadow: 0 0 10px rgba(0,119,182,0.2); }
        .answer-input.correct { border-color: #48bb78; background: #c6f6d5; }
        .answer-input.incorrect { border-color: #f56565; background: #fed7d7; }
        .btn { padding: 14px 35px; font-size: 1.1em; border: none; border-radius: 10px; cursor: pointer; margin: 5px; transition: all 0.3s; font-weight: bold; }
        .check-btn { background: linear-gradient(135deg, #0077b6 0%, #023e8a 100%); color: white; }
        .check-btn:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,119,182,0.3); }
        .next-btn { background: linear-gradient(135deg, #48bb78 0%, #38a169 100%); color: white; }
        .back-btn { background: #6c757d; color: white; }
        .result-summary { background: linear-gradient(135deg, #e0f7fa 0%, #b2ebf2 100%); padding: 25px; border-radius: 12px; text-align: center; font-size: 1.3em; margin-bottom: 20px; }
        .button-group { display: flex; justify-content: center; flex-wrap: wrap; gap: 10px; margin: 20px 0; }
        .hidden { display: none; }
        .install-prompt { display: none; background: linear-gradient(135deg, #48bb78 0%, #38a169 100%); color: white; padding: 15px; border-radius: 10px; margin-bottom: 20px; text-align: center; }
        .install-btn { background: white; color: #38a169; border: none; padding: 10px 20px; border-radius: 5px; font-weight: bold; cursor: pointer; margin-top: 10px; }
    </style>
</head>
<body>
    <div class="container">
        <div id="installPrompt" class="install-prompt">
            <div>üì± –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω –¥–ª—è —É–¥–æ–±–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞!</div>
            <button class="install-btn" onclick="installApp()">–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</button>
        </div>
        
        <div class="header">
            <h1>üéì –ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞</h1>
            <p class="subtitle">–ü—Ä–æ–≥—Ä–∞–º–º–∞ –ú–∏–Ω–∏—Å—Ç–µ—Ä—Å—Ç–≤–∞ –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –†–ö</p>
        </div>

        <div class="name-input-section">
            <label for="studentName" style="font-size: 1.1em; font-weight: bold; color: #0077b6; display: block; margin-bottom: 10px;">üë§ –í–≤–µ–¥–∏—Ç–µ –∏–º—è —É—á–µ–Ω–∏–∫–∞:</label>
            <input type="text" id="studentName" class="name-input" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ê–π–≥—É–ª—å">
        </div>

        <div class="tabs">
            <button class="tab active" onclick="showTab('practice')">üìù –ü—Ä–∞–∫—Ç–∏–∫–∞</button>
            <button class="tab" onclick="showTab('stats')">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</button>
        </div>

        <div id="statsSection" class="stats-section">
            <div class="leaderboard">
                <h2 style="color: #0077b6; margin-bottom: 20px;">üèÜ –¢–∞–±–ª–∏—Ü–∞ –ª–∏–¥–µ—Ä–æ–≤</h2>
                <table id="leaderboardTable">
                    <thead>
                        <tr>
                            <th>–ú–µ—Å—Ç–æ</th>
                            <th>–ò–º—è</th>
                            <th>–ë–∞–ª–ª—ã</th>
                            <th>–ü—Ä–∞–≤–∏–ª—å–Ω—ã—Ö</th>
                            <th>–í—Å–µ–≥–æ –∑–∞–¥–∞—á</th>
                            <th>–¢–æ—á–Ω–æ—Å—Ç—å</th>
                        </tr>
                    </thead>
                    <tbody id="leaderboardBody"></tbody>
                </table>
            </div>
        </div>

        <div id="practiceSection" class="stats-section active">
            <div id="gradeSelection">
                <h2 style="text-align: center; color: #0077b6; margin-bottom: 20px;">–í—ã–±–µ—Ä–∏—Ç–µ –∫–ª–∞—Å—Å:</h2>
                <div class="grade-selection">
                    <button class="grade-btn" onclick="selectGrade(1)">1<br>–∫–ª–∞—Å—Å</button>
                    <button class="grade-btn" onclick="selectGrade(2)">2<br>–∫–ª–∞—Å—Å</button>
                    <button class="grade-btn" onclick="selectGrade(3)">3<br>–∫–ª–∞—Å—Å</button>
                    <button class="grade-btn" onclick="selectGrade(4)">4<br>–∫–ª–∞—Å—Å</button>
                    <button class="grade-btn" onclick="selectGrade(5)">5<br>–∫–ª–∞—Å—Å</button>
                    <button class="grade-btn" onclick="selectGrade(6)">6<br>–∫–ª–∞—Å—Å</button>
                    <button class="grade-btn" onclick="selectGrade(7)">7<br>–∫–ª–∞—Å—Å</button>
                </div>
            </div>

            <div id="topicSelection" class="topic-selection">
                <h2 style="text-align: center; color: #0077b6; margin-bottom: 20px;">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–µ–º—É:</h2>
                <div class="topic-grid" id="topicButtons"></div>
                <div style="text-align: center;">
                    <button class="btn back-btn" onclick="backToGrades()">‚Üê –ù–∞–∑–∞–¥ –∫ –∫–ª–∞—Å—Å–∞–º</button>
                </div>
            </div>

            <div id="quizArea" class="quiz-area">
                <div class="result-summary" id="resultSummary"></div>
                <div class="questions-grid" id="questionsGrid"></div>
                <div class="button-group">
                    <button class="btn check-btn" onclick="checkAllAnswers()">‚úì –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ</button>
                    <button class="btn next-btn" onclick="generateNewSet()">–ù–æ–≤—ã–π –Ω–∞–±–æ—Ä ‚Üí</button>
                    <button class="btn back-btn" onclick="backToTopics()">‚Üê –ù–∞–∑–∞–¥ –∫ —Ç–µ–º–∞–º</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentGrade = 0;
        let currentTopic = '';
        let currentQuestions = [];
        let studentResults = {};
        let deferredPrompt;

        // PWA Installation
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            document.getElementById('installPrompt').style.display = 'block';
        });
        
        function installApp() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ');
                    }
                    deferredPrompt = null;
                    document.getElementById('installPrompt').style.display = 'none';
                });
            }
        }
        
        // Service Worker Registration
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js').then(function(registration) {
                console.log('Service Worker –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω');
            }).catch(function(err) {
                console.log('–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ Service Worker:', err);
            });
        }

        const topics = {
            1: ['–ß–∏—Å–ª–∞ –æ—Ç 1 –¥–æ 10', '–°–ª–æ–∂–µ–Ω–∏–µ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö 10', '–í—ã—á–∏—Ç–∞–Ω–∏–µ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö 10', '–ß–∏—Å–ª–∞ –æ—Ç 11 –¥–æ 20', '–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —á–∏—Å–µ–ª', '–°–æ—Å—Ç–∞–≤ —á–∏—Å–µ–ª', '–ó–∞–¥–∞—á–∏ –Ω–∞ –ª–æ–≥–∏–∫—É'],
            2: ['–ß–∏—Å–ª–∞ –æ—Ç 1 –¥–æ 100', '–°–ª–æ–∂–µ–Ω–∏–µ –∏ –≤—ã—á–∏—Ç–∞–Ω–∏–µ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö 20', '–°–ª–æ–∂–µ–Ω–∏–µ –∏ –≤—ã—á–∏—Ç–∞–Ω–∏–µ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö 100', '–¢–∞–±–ª–∏—Ü–∞ —É–º–Ω–æ–∂–µ–Ω–∏—è –Ω–∞ 2, 3', '–î–µ–ª–µ–Ω–∏–µ –Ω–∞ 2, 3', '–¢–µ–∫—Å—Ç–æ–≤—ã–µ –∑–∞–¥–∞—á–∏', '–õ–æ–≥–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞—á–∏'],
            3: ['–ß–∏—Å–ª–∞ –¥–æ 1000', '–°–ª–æ–∂–µ–Ω–∏–µ –∏ –≤—ã—á–∏—Ç–∞–Ω–∏–µ —Ç—Ä—ë—Ö–∑–Ω–∞—á–Ω—ã—Ö', '–¢–∞–±–ª–∏—Ü–∞ —É–º–Ω–æ–∂–µ–Ω–∏—è (–≤—Å—è)', '–í–Ω–µ—Ç–∞–±–ª–∏—á–Ω–æ–µ —É–º–Ω–æ–∂–µ–Ω–∏–µ', '–î–µ–ª–µ–Ω–∏–µ —Å –æ—Å—Ç–∞—Ç–∫–æ–º', '–î–æ–ª–∏ –∏ –¥—Ä–æ–±–∏', '–ó–∞–¥–∞—á–∏ –Ω–∞ –¥–≤–∏–∂–µ–Ω–∏–µ', '–õ–æ–≥–∏–∫–∞ –∏ —Ä–µ–±—É—Å—ã'],
            4: ['–ú–Ω–æ–≥–æ–∑–Ω–∞—á–Ω—ã–µ —á–∏—Å–ª–∞', '–ß–µ—Ç—ã—Ä–µ –∞—Ä–∏—Ñ–º–µ—Ç–∏—á–µ—Å–∫–∏—Ö –¥–µ–π—Å—Ç–≤–∏—è', '–ü–∏—Å—å–º–µ–Ω–Ω–æ–µ —É–º–Ω–æ–∂–µ–Ω–∏–µ', '–ü–∏—Å—å–º–µ–Ω–Ω–æ–µ –¥–µ–ª–µ–Ω–∏–µ', '–°–∫–æ—Ä–æ—Å—Ç—å, –≤—Ä–µ–º—è, —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ', '–ü–ª–æ—â–∞–¥—å –∏ –ø–µ—Ä–∏–º–µ—Ç—Ä', '–î—Ä–æ–±–∏', '–õ–æ–≥–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞—á–∏'],
            5: ['–ù–∞—Ç—É—Ä–∞–ª—å–Ω—ã–µ —á–∏—Å–ª–∞', '–û–±—ã–∫–Ω–æ–≤–µ–Ω–Ω—ã–µ –¥—Ä–æ–±–∏', '–°–ª–æ–∂–µ–Ω–∏–µ –∏ –≤—ã—á–∏—Ç–∞–Ω–∏–µ –¥—Ä–æ–±–µ–π', '–£–º–Ω–æ–∂–µ–Ω–∏–µ –∏ –¥–µ–ª–µ–Ω–∏–µ –¥—Ä–æ–±–µ–π', '–î–µ—Å—è—Ç–∏—á–Ω—ã–µ –¥—Ä–æ–±–∏', '–ü—Ä–æ—Ü–µ–Ω—Ç—ã', '–£—Ä–∞–≤–Ω–µ–Ω–∏—è', '–ü–ª–æ—â–∞–¥—å –∏ –æ–±—ä—ë–º', '–õ–æ–≥–∏–∫–∞'],
            6: ['–î–µ–ª–∏–º–æ—Å—Ç—å —á–∏—Å–µ–ª', '–†–∞—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —á–∏—Å–ª–∞', '–ú–æ–¥—É–ª—å —á–∏—Å–ª–∞', '–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ä–∞—Ü–∏–æ–Ω–∞–ª—å–Ω—ã—Ö —á–∏—Å–µ–ª', '–î–µ–π—Å—Ç–≤–∏—è —Å —Ä–∞—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–º–∏ —á–∏—Å–ª–∞–º–∏', '–ü—Ä–æ–ø–æ—Ä—Ü–∏–∏', '–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–Ω–∞—è –ø–ª–æ—Å–∫–æ—Å—Ç—å', '–õ–æ–≥–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞—á–∏'],
            7: ['–ê–ª–≥–µ–±—Ä–∞–∏—á–µ—Å–∫–∏–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è', '–õ–∏–Ω–µ–π–Ω—ã–µ —É—Ä–∞–≤–Ω–µ–Ω–∏—è', '–°—Ç–µ–ø–µ–Ω–∏', '–û–¥–Ω–æ—á–ª–µ–Ω—ã', '–ú–Ω–æ–≥–æ—á–ª–µ–Ω—ã', '–§–æ—Ä–º—É–ª—ã —Å–æ–∫—Ä–∞—â—ë–Ω–Ω–æ–≥–æ —É–º–Ω–æ–∂–µ–Ω–∏—è', '–°–∏—Å—Ç–µ–º—ã —É—Ä–∞–≤–Ω–µ–Ω–∏–π', '–ó–∞–¥–∞—á–∏ –Ω–∞ –ª–æ–≥–∏–∫—É']
        };

        function showTab(tab) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.stats-section').forEach(s => s.classList.remove('active'));
            
            if (tab === 'stats') {
                event.target.classList.add('active');
                document.getElementById('statsSection').classList.add('active');
                updateLeaderboard();
            } else {
                document.querySelector('.tab').classList.add('active');
                document.getElementById('practiceSection').classList.add('active');
            }
        }

        function loadResults() {
            const saved = localStorage.getItem('studentResults');
            if (saved) {
                studentResults = JSON.parse(saved);
            }
        }

        function saveResults() {
            localStorage.setItem('studentResults', JSON.stringify(studentResults));
        }

        function updateLeaderboard() {
            const tbody = document.getElementById('leaderboardBody');
            tbody.innerHTML = '';
            
            const students = Object.entries(studentResults).map(([name, data]) => ({
                name,
                score: data.totalScore || 0,
                correct: data.totalCorrect || 0,
                total: data.totalQuestions || 0,
                accuracy: data.totalQuestions > 0 ? Math.round((data.totalCorrect / data.totalQuestions) * 100) : 0
            })).sort((a, b) => b.score - a.score);
            
            students.forEach((student, index) => {
                const row = tbody.insertRow();
                const medals = ['ü•á', 'ü•à', 'ü•â'];
                const medal = index < 3 ? medals[index] : (index + 1) + '.';
                
                row.innerHTML = `
                    <td><span class="medal">${medal}</span></td>
                    <td>${student.name}</td>
                    <td><strong>${student.score}</strong></td>
                    <td>${student.correct}</td>
                    <td>${student.total}</td>
                    <td>${student.accuracy}%</td>
                `;
            });
            
            if (students.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 20px;">–ü–æ–∫–∞ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö. –ù–∞—á–Ω–∏—Ç–µ —Ä–µ—à–∞—Ç—å –∑–∞–¥–∞—á–∏!</td></tr>';
            }
        }

        function selectGrade(grade) {
            currentGrade = grade;
            document.getElementById('gradeSelection').style.display = 'none';
            document.getElementById('topicSelection').style.display = 'block';
            
            const topicButtons = document.getElementById('topicButtons');
            topicButtons.innerHTML = '';
            
            topics[grade].forEach(topic => {
                const btn = document.createElement('button');
                btn.className = 'topic-btn';
                btn.textContent = topic;
                btn.onclick = () => selectTopic(topic);
                topicButtons.appendChild(btn);
            });
        }

        function selectTopic(topic) {
            currentTopic = topic;
            document.getElementById('topicSelection').style.display = 'none';
            document.getElementById('quizArea').style.display = 'block';
            generateNewSet();
        }

        function generateNewSet() {
            currentQuestions = [];
            for (let i = 0; i < 4; i++) {
                currentQuestions.push(generateQuestion());
            }
            renderQuestions();
            document.getElementById('resultSummary').innerHTML = '';
        }

        function generateQuestion() {
            let question, answer, type = '–ê—Ä–∏—Ñ–º–µ—Ç–∏–∫–∞';
            
            if (currentTopic.includes('–ª–æ–≥–∏–∫') || currentTopic.includes('—Ä–µ–±—É—Å')) {
                return generateLogicQuestion();
            }
            
            switch(currentTopic) {
                case '–ß–∏—Å–ª–∞ –æ—Ç 1 –¥–æ 10':
                case '–°–ª–æ–∂–µ–Ω–∏–µ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö 10':
                    const a1 = Math.floor(Math.random() * 9) + 1;
                    const b1 = Math.floor(Math.random() * (10 - a1)) + 1;
                    question = `${a1} + ${b1}`;
                    answer = a1 + b1;
                    break;
                    
                case '–í—ã—á–∏—Ç–∞–Ω–∏–µ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö 10':
                    const a2 = Math.floor(Math.random() * 9) + 2;
                    const b2 = Math.floor(Math.random() * a2) + 1;
                    question = `${a2} - ${b2}`;
                    answer = a2 - b2;
                    break;
                    
                case '–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —á–∏—Å–µ–ª':
                    const n1 = Math.floor(Math.random() * 20) + 1;
                    const n2 = Math.floor(Math.random() * 20) + 1;
                    question = `–ë–æ–ª—å—à–µ–µ –∏–∑ ${n1} –∏ ${n2}`;
                    answer = Math.max(n1, n2);
                    type = '–°—Ä–∞–≤–Ω–µ–Ω–∏–µ';
                    break;
                    
                case '–¢–∞–±–ª–∏—Ü–∞ —É–º–Ω–æ–∂–µ–Ω–∏—è –Ω–∞ 2, 3':
                case '–¢–∞–±–ª–∏—Ü–∞ —É–º–Ω–æ–∂–µ–Ω–∏—è (–≤—Å—è)':
                    const mult = currentGrade <= 2 ? [2, 3][Math.floor(Math.random() * 2)] : Math.floor(Math.random() * 8) + 2;
                    const num = Math.floor(Math.random() * 9) + 2;
                    question = `${mult} √ó ${num}`;
                    answer = mult * num;
                    break;
                    
                case '–î–µ–ª–µ–Ω–∏–µ –Ω–∞ 2, 3':
                case '–î–µ–ª–µ–Ω–∏–µ —Å –æ—Å—Ç–∞—Ç–∫–æ–º':
                    const div = currentGrade <= 2 ? [2, 3][Math.floor(Math.random() * 2)] : Math.floor(Math.random() * 7) + 2;
                    const res = Math.floor(Math.random() * 9) + 2;
                    question = `${div * res} √∑ ${div}`;
                    answer = res;
                    break;
                    
                case '–¢–µ–∫—Å—Ç–æ–≤—ã–µ –∑–∞–¥–∞—á–∏':
                    const stories = [
                        {q: `–£ –ê—Å–µ–ª—å ${Math.floor(Math.random() * 10) + 5} —è–±–ª–æ–∫. –û–Ω–∞ –¥–∞–ª–∞ ${Math.floor(Math.random() * 3) + 1}. –°–∫–æ–ª—å–∫–æ –æ—Å—Ç–∞–ª–æ—Å—å?`},
                        {q: `–í –∫–ª–∞—Å—Å–µ ${Math.floor(Math.random() * 10) + 15} –º–∞–ª—å—á–∏–∫–æ–≤ –∏ ${Math.floor(Math.random() * 10) + 15} –¥–µ–≤–æ—á–µ–∫. –í—Å–µ–≥–æ –¥–µ—Ç–µ–π?`}
                    ];
                    const nums = question.match(/\d+/g).map(Number);
                    answer = nums.reduce((a, b) => a + b, 0);
                    question = stories[Math.floor(Math.random() * stories.length)].q;
                    break;
                    
                case '–î–µ—Å—è—Ç–∏—á–Ω—ã–µ –¥—Ä–æ–±–∏':
                    const d1 = (Math.floor(Math.random() * 50) + 10) / 10;
                    const d2 = (Math.floor(Math.random() * 30) + 5) / 10;
                    question = `${d1} + ${d2}`;
                    answer = Math.round((d1 + d2) * 10) / 10;
                    break;
                    
                case '–ü—Ä–æ—Ü–µ–Ω—Ç—ã':
                    const base = [100, 200, 500][Math.floor(Math.random() * 3)];
                    const perc = [10, 20, 50][Math.floor(Math.random() * 3)];
                    question = `${perc}% –æ—Ç ${base}`;
                    answer = base * perc / 100;
                    break;
                    
                case '–õ–∏–Ω–µ–π–Ω—ã–µ —É—Ä–∞–≤–Ω–µ–Ω–∏—è':
                case '–£—Ä–∞–≤–Ω–µ–Ω–∏—è':
                    const x = Math.floor(Math.random() * 20) + 1;
                    const c = Math.floor(Math.random() * 30) + 10;
                    question = `x + ${c} = ${x + c}, x = ?`;
                    answer = x;
                    type = '–£—Ä–∞–≤–Ω–µ–Ω–∏–µ';
                    break;
                    
                default:
                    const ra = Math.floor(Math.random() * 50) + 10;
                    const rb = Math.floor(Math.random() * 30) + 5;
                    question = `${ra} + ${rb}`;
                    answer = ra + rb;
            }
            
            return { question, answer, type };
        }

        function generateLogicQuestion() {
            const logicQuestions = [
                { question: '–£ –ê–π–≥—É–ª—å 2 —è–±–ª–æ–∫–∞. –£ –ê—Å–µ–ª—å –Ω–∞ 3 –±–æ–ª—å—à–µ. –°–∫–æ–ª—å–∫–æ —É –ê—Å–µ–ª—å?', answer: 5 },
                { question: '–ü—Ä–æ–¥–æ–ª–∂–∏: 2, 4, 6, 8, ?', answer: 10 },
                { question: '–ï—Å–ª–∏ 5 + 3 = 8, —Ç–æ 8 - 3 = ?', answer: 5 },
                { question: '–£ –∫–æ—à–∫–∏ 4 –ª–∞–ø—ã. –£ –¥–≤—É—Ö –∫–æ—à–µ–∫ —Å–∫–æ–ª—å–∫–æ –ª–∞–ø?', answer: 8 },
                { question: '10 - 2 - 2 - 2 = ?', answer: 4 },
                { question: '–ü—Ä–æ–¥–æ–ª–∂–∏: 1, 3, 5, 7, ?', answer: 9 },
                { question: '–í –∫–æ—Ä–∑–∏–Ω–µ 10 —è–±–ª–æ–∫. –°—ä–µ–ª–∏ 3. –°–∫–æ–ª—å–∫–æ –æ—Å—Ç–∞–ª–æ—Å—å?', answer: 7 },
                { question: '3 + 3 + 3 = ? (–∑–∞–ø–∏—à–∏ –æ—Ç–≤–µ—Ç)', answer: 9 }
            ];
            
            const q = logicQuestions[Math.floor(Math.random() * logicQuestions.length)];
            return { question: q.question, answer: q.answer, type: '–õ–æ–≥–∏–∫–∞' };
        }

        function renderQuestions() {
            const grid = document.getElementById('questionsGrid');
            grid.innerHTML = '';
            
            currentQuestions.forEach((q, index) => {
                const card = document.createElement('div');
                card.className = 'question-card';
                card.innerHTML = `
                    <div class="question-number">${q.type} ‚Ä¢ –ó–∞–¥–∞—á–∞ ${index + 1}</div>
                    <div class="question-text">${q.question} = ?</div>
                    <input type="number" step="0.1" class="answer-input" id="answer${index}" placeholder="–í–∞—à –æ—Ç–≤–µ—Ç">
                `;
                grid.appendChild(card);
            });
        }

        function checkAllAnswers() {
            const name = document.getElementById('studentName').value.trim();
            if (!name) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∏–º—è —É—á–µ–Ω–∏–∫–∞!');
                return;
            }
            
            let correct = 0;
            let total = currentQuestions.length;
            
            currentQuestions.forEach((q, index) => {
                const input = document.getElementById(`answer${index}`);
                const userAnswer = parseFloat(input.value);
                
                if (Math.abs(userAnswer - q.answer) < 0.01) {
                    correct++;
                    input.classList.add('correct');
                    input.classList.remove('incorrect');
                } else {
                    input.classList.add('incorrect');
                    input.classList.remove('correct');
                }
            });
            
            const score = correct * 10;
            
            if (!studentResults[name]) {
                studentResults[name] = { totalScore: 0, totalCorrect: 0, totalQuestions: 0 };
            }
            
            studentResults[name].totalScore += score;
            studentResults[name].totalCorrect += correct;
            studentResults[name].totalQuestions += total;
            
            saveResults();
            
            const accuracy = Math.round((correct / total) * 100);
            document.getElementById('resultSummary').innerHTML = `
                <strong>${name}</strong>: ${correct} –∏–∑ ${total} (${accuracy}%) ‚Ä¢ +${score} –±–∞–ª–ª–æ–≤ üéâ
            `;
        }

        function backToTopics() {
            document.getElementById('quizArea').style.display = 'none';
            document.getElementById('topicSelection').style.display = 'block';
        }

        function backToGrades() {
            document.getElementById('topicSelection').style.display = 'none';
            document.getElementById('gradeSelection').style.display = 'block';
        }

        loadResults();
    </script>
</body>
</html>